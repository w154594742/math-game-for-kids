<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="è¶£å‘³æ•°å­¦å°å¤©åœ° - è®©å­©å­åœ¨æ¸¸æˆä¸­å¿«ä¹å­¦ä¹ æ•°å­¦">
    <meta name="keywords" content="å„¿ç«¥æ•°å­¦,æ•°å­¦æ¸¸æˆ,æ•™è‚²æ¸¸æˆ,åŠ å‡ä¹˜é™¤">
    <meta name="author" content="è¶£å‘³æ•°å­¦å°å¤©åœ°">
    <title>è¶£å‘³æ•°å­¦å°å¤©åœ°</title>
    
    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/scenes.css">

    <!-- åœºæ™¯ä¸“ç”¨æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="css/scenes/party-scene.css">
    
    <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preload" href="js/app.js" as="script">
    <link rel="preload" href="js/game-engine.js" as="script">
</head>
<body>
    <div id="app">
        <!-- ä¸»é¡µé¢ -->
        <div id="home-view" class="view active">
            <header class="game-header">
                <h1>ğŸ® è¶£å‘³æ•°å­¦å°å¤©åœ°</h1>
                <p class="subtitle">åœ¨æ¸¸æˆä¸­å¿«ä¹å­¦ä¹ æ•°å­¦ï¼</p>
            </header>
            
            <main class="game-main">
                <!-- è§’è‰²é€‰æ‹©åŒºåŸŸ -->
                <section class="character-selection">
                    <h2>é€‰æ‹©ä½ çš„å­¦ä¹ ä¼™ä¼´</h2>
                    <div class="character-grid">
                        <div class="character-card" data-character="bear">
                            <div class="character-avatar">ğŸ»</div>
                            <span>å°ç†Š</span>
                        </div>
                        <div class="character-card" data-character="cat">
                            <div class="character-avatar">ğŸ±</div>
                            <span>å°çŒ«</span>
                        </div>
                        <div class="character-card" data-character="rabbit">
                            <div class="character-avatar">ğŸ°</div>
                            <span>å°å…”</span>
                        </div>
                    </div>
                </section>
                
                <!-- è¿ç®—ç±»å‹é€‰æ‹© -->
                <section class="operation-selection">
                    <h2>é€‰æ‹©ç»ƒä¹ ç±»å‹</h2>
                    <div class="operation-grid">
                        <button class="btn btn-large operation-btn" data-operation="addition">
                            â• åŠ æ³•ç»ƒä¹ 
                        </button>
                        <button class="btn btn-large operation-btn" data-operation="subtraction">
                            â– å‡æ³•ç»ƒä¹ 
                        </button>
                        <button class="btn btn-large operation-btn" data-operation="multiplication">
                            âœ–ï¸ ä¹˜æ³•ç»ƒä¹ 
                        </button>
                        <button class="btn btn-large operation-btn" data-operation="division">
                            â— é™¤æ³•ç»ƒä¹ 
                        </button>
                    </div>
                </section>
                
                <!-- éš¾åº¦é€‰æ‹© -->
                <section class="difficulty-selection">
                    <h2>é€‰æ‹©éš¾åº¦çº§åˆ«</h2>
                    <div class="difficulty-grid">
                        <button class="btn btn-secondary difficulty-btn" data-difficulty="1">
                            ğŸŒŸ å¯è’™çº§<br><small>10ä»¥å†…</small>
                        </button>
                        <button class="btn btn-secondary difficulty-btn" data-difficulty="2">
                            â­â­ å…¥é—¨çº§<br><small>20ä»¥å†…</small>
                        </button>
                        <button class="btn btn-secondary difficulty-btn" data-difficulty="3">
                            â­â­â­ è¿›é˜¶çº§<br><small>100ä»¥å†…</small>
                        </button>
                    </div>
                </section>
                
                <!-- å¼€å§‹æ¸¸æˆæŒ‰é’® -->
                <section class="start-section">
                    <button id="start-game-btn" class="btn btn-success btn-large" disabled>
                        ğŸš€ å¼€å§‹æ¸¸æˆ
                    </button>
                </section>
            </main>
        </div>
        
        <!-- æ¸¸æˆé¡µé¢ -->
        <div id="game-view" class="view">
            <!-- æ¸¸æˆå¤´éƒ¨ä¿¡æ¯ -->
            <header class="game-header">
                <div class="game-info">
                    <div class="score-info">
                        <span>å¾—åˆ†: </span>
                        <span id="current-score" class="score-number">0</span>
                    </div>
                    <div class="progress-info">
                        <span>è¿›åº¦: </span>
                        <span id="question-progress">1/10</span>
                    </div>
                    <div class="streak-info">
                        <span>è¿å‡»: </span>
                        <span id="current-streak">0</span>
                    </div>
                </div>
            </header>
            
            <!-- åœºæ™¯èƒŒæ™¯å®¹å™¨ -->
            <div id="scene-container" class="scene-container">
                <!-- åŠ¨æ€åŠ è½½ä¸åŒåœºæ™¯èƒŒæ™¯ -->
            </div>
            

            
            <!-- æ¸¸æˆæ§åˆ¶åŒº -->
            <div id="game-controls" class="game-controls">
                <button id="reset-question-btn" class="btn">ğŸ”„ é‡æ–°å¼€å§‹</button>
                <button id="back-home-btn" class="btn btn-secondary">ğŸ  è¿”å›ä¸»é¡µ</button>
            </div>
        </div>
        
        <!-- ç»“æœé¡µé¢ -->
        <div id="result-view" class="view">
            <header class="game-header">
                <h1>ğŸ‰ æ¸¸æˆç»“æŸï¼</h1>
            </header>
            
            <main class="result-main">
                <!-- æˆç»©ç»Ÿè®¡ -->
                <section class="score-summary">
                    <div class="final-score">
                        <h2>æœ€ç»ˆå¾—åˆ†</h2>
                        <div id="final-score-number" class="big-number">0</div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">æ­£ç¡®ç‡</div>
                            <div id="accuracy-percentage" class="stat-value">0%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æœ€é«˜è¿å‡»</div>
                            <div id="max-streak" class="stat-value">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ç”¨æ—¶</div>
                            <div id="total-time" class="stat-value">0ç§’</div>
                        </div>
                    </div>
                </section>
                
                <!-- å¥–åŠ±å±•ç¤º -->
                <section class="rewards-section">
                    <h3>ğŸ† è·å¾—å¥–åŠ±</h3>
                    <div id="achievements-list" class="achievements-list">
                        <!-- åŠ¨æ€æ˜¾ç¤ºè·å¾—çš„æˆå°± -->
                    </div>
                </section>
                
                <!-- ç»§ç»­æ¸¸æˆé€‰é¡¹ -->
                <section class="continue-section">
                    <button id="play-again-btn" class="btn btn-success btn-large">
                        ğŸ”„ å†ç©ä¸€æ¬¡
                    </button>
                    <button id="change-settings-btn" class="btn btn-secondary">
                        âš™ï¸ æ›´æ¢è®¾ç½®
                    </button>
                    <button id="view-progress-btn" class="btn">
                        ğŸ“Š æŸ¥çœ‹è¿›åº¦
                    </button>
                </section>
            </main>
        </div>
        
        <!-- è®¾ç½®é¡µé¢ -->
        <div id="settings-view" class="view">
            <header class="game-header">
                <h1>âš™ï¸ æ¸¸æˆè®¾ç½®</h1>
            </header>
            
            <main class="settings-main">
                <section class="settings-section">
                    <div class="setting-item">
                        <label for="sound-toggle">ğŸ”Š éŸ³æ•ˆ</label>
                        <input type="checkbox" id="sound-toggle" checked>
                    </div>
                    
                    <div class="setting-item">
                        <label for="session-length">ğŸ“ æ¯è½®é¢˜ç›®æ•°é‡</label>
                        <select id="session-length">
                            <option value="5">5é¢˜</option>
                            <option value="10" selected>10é¢˜</option>
                            <option value="15">15é¢˜</option>
                            <option value="20">20é¢˜</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <label for="difficulty-mode">ğŸ¯ éš¾åº¦æ¨¡å¼</label>
                        <select id="difficulty-mode">
                            <option value="auto" selected>è‡ªåŠ¨è°ƒæ•´</option>
                            <option value="fixed">å›ºå®šéš¾åº¦</option>
                        </select>
                    </div>
                </section>
                
                <section class="data-section">
                    <h3>ğŸ“Š æ•°æ®ç®¡ç†</h3>
                    <button id="export-data-btn" class="btn">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                    <button id="import-data-btn" class="btn">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                    <button id="reset-data-btn" class="btn btn-secondary">ğŸ—‘ï¸ é‡ç½®æ•°æ®</button>
                </section>
                
                <section class="back-section">
                    <button id="back-from-settings-btn" class="btn btn-success">
                        â† è¿”å›ä¸»é¡µ
                    </button>
                </section>
            </main>
        </div>
    </div>
    
    <!-- åŠ è½½æç¤º -->
    <div id="loading" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨åŠ è½½...</p>
        </div>
    </div>
    
    <!-- JavaScriptæ–‡ä»¶ -->
    <script src="js/game-engine.js"></script>
    <script src="js/ui-manager.js"></script>
    <!-- åœºæ™¯é…ç½®å’ŒåŸºç¡€ç±» -->
    <script src="js/config/scene-items.js"></script>
    <script src="js/scenes/base-scene.js"></script>
    <!-- å…·ä½“åœºæ™¯ç±» -->
    <script src="js/scenes/shopping-scene.js"></script>
    <script src="js/scenes/sharing-scene.js"></script>
    <script src="js/scenes/garden-scene.js"></script>
    <script src="js/scenes/party-scene.js"></script>
    <!-- ä¸»ç®¡ç†å™¨ -->
    <script src="js/scene-manager.js"></script>
    <script src="js/drag-drop-manager.js"></script>
    <script src="js/audio-manager.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/app.js"></script>
    
    <!-- åˆå§‹åŒ–è„šæœ¬ -->
    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–åº”ç”¨...');

            try {
                // åˆ›å»ºAppå®ä¾‹
                app = new App();
                console.log('Appå®ä¾‹å·²åˆ›å»º:', app);

                // å°†åº”ç”¨å®ä¾‹è®¾ä¸ºå…¨å±€å˜é‡ï¼Œæ–¹ä¾¿è°ƒè¯•
                window.app = app;

                // åˆå§‹åŒ–åº”ç”¨
                await app.init();

                console.log('åº”ç”¨åˆå§‹åŒ–å®Œæˆï¼');

                // æ˜¾ç¤ºåˆå§‹åŒ–æˆåŠŸä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
                const initMessage = document.createElement('div');
                initMessage.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: #4CAF50;
                    color: white;
                    padding: 10px;
                    border-radius: 5px;
                    font-size: 12px;
                    z-index: 10000;
                    opacity: 0.9;
                `;
                initMessage.textContent = 'âœ… åº”ç”¨åˆå§‹åŒ–æˆåŠŸ';
                document.body.appendChild(initMessage);

                // 3ç§’åç§»é™¤æç¤º
                setTimeout(() => {
                    if (initMessage.parentNode) {
                        initMessage.parentNode.removeChild(initMessage);
                    }
                }, 3000);

            } catch (error) {
                console.error('åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);

                // æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #f44336;
                    color: white;
                    padding: 20px;
                    border-radius: 10px;
                    max-width: 500px;
                    z-index: 10000;
                    text-align: center;
                `;
                errorDiv.innerHTML = `
                    <h3>âŒ åº”ç”¨åˆå§‹åŒ–å¤±è´¥</h3>
                    <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                    <p>è¯·æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</p>
                    <button onclick="location.reload()" style="
                        background: white;
                        color: #f44336;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                        margin-top: 10px;
                    ">åˆ·æ–°é¡µé¢</button>
                `;
                document.body.appendChild(errorDiv);
            }
        });
    </script>
</body>
</html>
